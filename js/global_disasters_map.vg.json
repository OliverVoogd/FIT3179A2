{
	"$schema": "https://vega.github.io/schema/vega-lite/v5.json",
	"data": {
		"url": "https://raw.githubusercontent.com/OliverVoogd/FIT3179A2/master/data/emdat_trimmed_joined_sedac.csv"
	},
	"params": [
		{
			"name": "CountrySelect",
			"value": ["Australia", "England", "Japan", "China", "India"]
		},
		{
			"name": "YearSelect",
			"value": 2018,
			"bind": {
				"input": "range",
				"min": 1980,
				"max": 2018,
				"step": 1
			}
		}
	],
	"vconcat": [
		{
			"title": "World Map of Natural Disasters 1980-2018",
			"width": 922,
			"height": 522,
			"view": {"fill": "#8fb5ca"},
			"projection": {"type": "equalEarth"},
			"layer": [
				{
					"data": {
						"url": "https://raw.githubusercontent.com/OliverVoogd/FIT3179A2/master/data/countries.topo.json",
						"format": {"type":"topojson", "feature":"ne_50m_admin_0_countries"}
					},
					"mark": {"type":"geoshape", "fill": "lightgray", "stroke": "darkgray"}
				},
				{
					"transform": [
						{"filter": "datum.year <= YearSelect"}
					],
					"mark": {
						"type": "circle",
						"opacity": 0.8,
						"stroke": "black",
						"strokeWidth": 0.2,
						"size": 15
					},
					"params": [
						{
							"name": "DisasterTypeSelect",
							"select": {"type": "point", "fields": ["disastertype"]},
							"bind": "legend"
						}
					],
					"encoding": {
						"longitude": {"field": "longitude", "type": "quantitative"},
						"latitude": {"field": "latitude", "type": "quantitative"},
						"color": {
							"field": "disastertype",
							"type": "nominal",
							"scale": {"scheme": "dark2"},
							"legend": {
								"title": "Disaster Type"
							}
						},
						"opacity": {
							"condition": {"param": "DisasterTypeSelect", "value": 0.8},
							"value": 0.1
						},
						"tooltip": [
							{"field": "disastertype", "type": "nominal", "title": "Disaster"},
							{"field": "country", "type": "nominal", "title": "Country"},
							{"field": "location", "type": "nominal", "title": "Location"},
							{"field": "year", "type": "nominal", "title": "Year"}
						] 
					}
				}
			] 
		},
		{
			"title": "Number of Natural Disasters for Each Year",
			"width": 922,
			"data": {
				"url": "https://raw.githubusercontent.com/OliverVoogd/FIT3179A2/master/data/summed_disastertype_year.csv"
			},
			"transform": [
				{"filter": "datum.year >= 1980"},
				{"filter": "datum.year <= YearSelect"}
			],
			"encoding": {
				"x": {"field": "year", "type": "nominal", "title": "Year"},
				"y": {"field": "count", "type": "quantitative", "title": "Number of Disasters"},
				"color": {
					"field": "disastertype",
					"type": "nominal",
					"scale": {"scheme": "dark2"}
				},
				"tooltip": [
					{"field": "disastertype", "type": "nominal", "title": "Disaster"},
					{"field": "year", "type": "nominal", "title": "Year"},
					{"field": "count", "type": "quantitative", "title": "Total (year)"}
				]
			},
			"layer": [
				{
					"mark": {"type": "line", "point": true},
					"encoding": {
						"opacity": {
							"condition": {"param": "DisasterTypeSelect", "value": 1},
							"value": 0.1
						}
					}
				},
				{
					"transform": [
						{"filter": "datum.year <= YearSelect"},
						{
							"window": [{"op": "rank", "as": "ranking"}],
							"sort": [{"field": "count", "order": "descending"}]
						},
						{"filter": "datum.ranking == 1"},
						{
							"calculate": "'The most disasters in one year: ' + datum.count",
							"as": "TextAnnotation"
						}
					],
					"mark": {"type": "text", "align": "left", "dx": -180, "dy": 0},
					"encoding": {
						"text": {"field": "TextAnnotation"},
						"opacity": {
							"condition": {"param": "DisasterTypeSelect", "value": 1},
							"value": 0.1
						}
					}
				}
			]
		}
	]
}